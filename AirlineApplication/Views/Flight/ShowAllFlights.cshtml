@model IEnumerable<AirlineApplication.Models.Flight>

@{
    ViewBag.Title = "Home Page";
}

<table class="table table-bordered">
    <thead class="thead-dark">
        <tr>
            <th scope="col">Code</th>
            <th scope="col">Date</th>
            <th scope="col">Time</th>
            <th scope="col">Status</th>
            <th scope="col">Departing</th>
            <th scope="col">Landing</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var flight in Model)
        {
            <tr>
                <td>@flight.Code</td>
                <td>@flight.Date.Date</td>
                <td>@flight.Date.TimeOfDay</td>
                <td>@flight.FlightStatus.Value</td>
                @foreach (var ar in @flight.Airports)
                {
                    <td>@ar.Airport.Name</td>
                }
                    <td class="actions">
                        <a href="@Url.Action("UpdateFlight", "Flight", new { id = flight.FlightId})">Edit</a>
                        <a href="#" class="js-delete-flight" data-flight-id="@flight.FlightId">
                        Delete
                        </a>
                    </td>
            </tr>
        }
    </tbody>
</table>

@section scripts
{
<script>
    $(document).ready(function () {
        $(".js-delete-flight").click(function (e) {
            var link = $(e.target);
            bootbox.dialog({
                title: "Confirm",
                message: "<p>Are you sure you want delete this flight</p>",
                size: 'large',
                buttons: {
                    no: {
                        label: "No",
                        className: 'btn-default',
                        callback: function () {
                            bootbox.hideAll();
                        }
                    },
                    yes: {
                        label: "Yes",
                        className: 'btn-danger',
                        callback: function () {
                            $.ajax({
                                url: `/api/flights/${link.attr('data-flight-id')}`,
                                method: "DELETE"
                            })
                                .done(function () {
                                    link.parents("tr").fadeOut(function () {
                                        $(this).remove();
                                    });
                                })
                                .fail(function (xhr, status, error) {
                                    alert("Result: " + status + " " + error + " " + xhr.status + " " + xhr.statusText);
                                });
                        }
                    },
                }
            });
        });
    });
</script>
}